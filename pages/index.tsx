import type { GetServerSideProps, NextPage } from 'next';
import Head from 'next/head';
import axios from 'axios';
import { Box, Container, Grid } from '@mui/material';
import { Products } from '../common/types/@appTypes';
import { useEffect } from 'react';
import ProductCard from '../common/components/ProductCard';
import Footer from '../common/components/Footer';

type Props = {
  products: Products;
};

const Home: NextPage<Props> = ({ products }) => {
  useEffect(() => {
    console.log(products);
  }, []);
  return (
    <Box sx={{ backgroundColor: 'secondary.main', height: '100%' }}>
      <Head>
        <title>Haysubi</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <Container component='main'>
        <Grid container spacing={1}>
          {products.map((product) => (
            <Grid item>
              <ProductCard />
            </Grid>
          ))}
        </Grid>
      </Container>
      <footer>
        <Footer />
      </footer>
    </Box>
  );
};

export default Home;

export const getServerSideProps = async () => {
  let returnObject;
  try {
    const res = await axios.get(`https://fakestoreapi.com/products`);
    const products: Products = await res.data;
    returnObject = {
      props: {
        products,
      },
    };
  } catch (e) {
    returnObject = { notFound: true };
    console.log('error');
  }
  return returnObject;
};
